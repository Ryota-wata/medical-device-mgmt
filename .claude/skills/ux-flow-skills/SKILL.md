---
name: ux-flow-skills
description: UXフロー設計（アクション配置・タイミング・状態遷移・段階的開示）をレビューし、問題を検出・修正する
allowed-tools: Read, Edit, Write, Glob, Grep
---

# UX Flow Skills

UXフロー設計に特化したコードレビュー・修正スキルです。アクションの配置タイミング、状態遷移、プログレッシブ・ディスクロージャー、タスク完了後の誘導、確認パターンをチェックします。

## 使い方

### レビューのみ
```
app/order/page.tsx をUX Flow Skillsでレビューして
```

### レビュー+修正
```
app/order/page.tsx をUX Flow Skillsでレビューして修正して
```

### フロー全体のレビュー
```
発注登録フローをUX Flow Skillsでレビューして
```

## 対応フロー

### Step 1: 対象ファイルの読み込みと操作フローの把握
```bash
Read: app/order/page.tsx
```
ユーザーの操作フロー（開始 → 入力 → 確認 → 完了 → 次のアクション）を特定する。

### Step 2: 制約に基づくレビュー
各カテゴリの制約に対して違反をチェックし、以下の形式で出力:

```markdown
### 違反事項

#### 1. [カテゴリ名] - [制約の要約]
**違反箇所:**
\`\`\`tsx
// 問題のあるコード
\`\`\`

**問題:** [MUST/SHOULD/NEVER] [制約内容]

**修正案:**
\`\`\`tsx
// 修正後のコード
\`\`\`
```

### Step 3: サマリー出力
```markdown
### サマリー

| カテゴリ | 違反数 |
|----------|--------|
| アクション配置・タイミング | X |
| プログレッシブ・ディスクロージャー | X |
| タスク完了後のUX | X |
| コンテキストアクション | X |
| エラー防止・確認パターン | X |
| フロー継続性 | X |
| 状態遷移 | X |
| 認知負荷 | X |
| **合計** | **X** |
```

### Step 4: 修正実行（依頼された場合）
Editツールで修正を適用

---

## 制約一覧

### アクション配置・タイミング（Action Placement & Timing）

#### 配置の原則
- **MUST** Primary CTA は1画面に1つに制限する。複数のPrimaryボタンはフォーカスを分散させる
- **MUST** アクションボタンは操作対象のコンテンツの近くに配置する（近接の法則）
- **MUST** 破壊的アクション（削除等）は建設的アクション（保存等）から物理的に離し、色でも区別する
- **SHOULD** フォームの Primary CTA（保存、送信）はフォーム末尾に配置し、入力フィールドと左揃えにする
- **SHOULD** ボタンラベルは具体的な動詞にする（「発注登録する」「発注書を出力」）。「OK」「はい」等の汎用ラベルは避ける
- **NEVER** 最も頻繁に使うアクションをメニューや別画面の奥に隠さない

#### タイミングの原則
- **MUST** アクションは、それが意味を持つタイミングでのみ表示する。未登録データの「出力」ボタン、未入力フォームの「確認」ボタンは不適切
- **MUST** 登録系フローでは、操作の自然な順序を守る: 入力 → 確認 → 登録 → 完了 → 後続アクション（出力・共有等）
- **SHOULD** 後続アクション（出力、印刷、共有）は登録完了後の画面または一覧画面の操作列に配置する
- **SHOULD** 権限要求（通知許可、位置情報等）はユーザーがアプリの価値を体験した後に表示する
- **NEVER** 登録前の画面に登録後にしか使えないアクションを配置しない（例: 未登録の発注の「発注書出力」）

### プログレッシブ・ディスクロージャー（Progressive Disclosure）

- **MUST** 初期画面にはコア機能のみ表示し、高度/稀な機能は2次レベルに遅延させる
- **MUST** 初期画面に表示されているものは「重要である」というシグナルになる。重要でないものを初期画面に置かない
- **MUST** 開示レベルは最大2段階まで（初期表示 + 1段階の展開）。3段階以上はユーザーが迷う
- **MUST** 何が「必須」で何が「高度」かはユーザーリサーチで判断する。開発者の推測ではなく
- **SHOULD** 展開要素（アコーディオン、ドロップダウン）には中身が予測できる説明的なラベルをつける
- **NEVER** ユーザーの主タスク完了に必要なアクションをプログレッシブ・ディスクロージャーの奥に隠さない

#### パターン選択ガイド

| パターン | 適切な場面 | 不適切な場面 |
|----------|-----------|-------------|
| **ウィザード** | 分岐ロジックのある線形プロセス、複雑で低頻度のタスク | 高頻度タスク、単純なデータ入力 |
| **タブ** | 2〜5セクションの並列コンテンツ（デスクトップ） | モバイル、6セクション以上 |
| **アコーディオン** | 多数の短いセクション、モバイル、任意項目 | セクション間の比較が必要な場合 |
| **単一スクロールフォーム** | 短いフォーム、全項目必須、線形 | 認知負荷が非常に高い場合 |

### タスク完了後のUX（Post-Task UX）

- **MUST** 完了画面は「次に何をすべきか」を必ず示す。最低1つの明確な次ステップアクションを提供する
- **MUST** 完了確認は何が起きたかを要約する（「発注 #PO-20250203-0001 を3件の品目で登録しました」）。単なる「成功！」は不可
- **MUST** フィードバックの強さはタスクの重要度に比例させる:

| タスク重要度 | フィードバック |
|-------------|--------------|
| 日常的操作（お気に入り追加等） | トースト通知（自動消去） |
| 重要な単発操作（発注登録等） | バナー + 次ステップ誘導 |
| 高リスクな完了（契約確定等） | 完了画面 + サマリー + アクション |
| バックグラウンド処理 | モーダルダイアログ + 詳細リンク |

- **SHOULD** エンティティ作成後は一覧画面（トースト通知付き）または作成されたエンティティの詳細画面にリダイレクトする
- **SHOULD** 重要なアクションには Undo オプションを提供する（5〜10秒のウィンドウ）
- **NEVER** 完了画面をグリーンのチェックマークだけで終わらせない（デッドエンド防止）
- **NEVER** 日常的操作に過剰な演出（紙吹雪等）を使わない

### コンテキストアクション（Contextual Actions）

#### Disabled vs Hidden
- **SHOULD** 一時的に利用不可で、ユーザーが特定の操作をすれば有効化されるアクション → **Disabled** にする
- **SHOULD** ユーザーに権限がない、または極めて稀な状況でしか使わないアクション → **Hidden** にする
- **MUST** Disabled ボタンにはなぜ無効なのかを説明する（ツールチップ、ヘルパーテキスト）
- **SHOULD** 代替案: Disabled にする代わりにボタンを有効のままにし、クリック時にコンテキストエラーを表示する

#### CRUD パターン
- **MUST** Create/Edit モードの「保存」（Primary）と「キャンセル」（Secondary）は視覚的に明確に区別する
- **MUST** View モードで利用可能なアクションは、ナビゲーション・共有・編集モードへの遷移に限定する
- **SHOULD** 低リスクな編集はオートセーブにする。高リスクな編集は明示的な保存 + 下書き機構を設ける
- **NEVER** フォームに「リセット」ボタンを配置しない。ほぼ常に誤クリックによるデータ損失を引き起こす

### エラー防止・確認パターン（Error Prevention & Confirmation）

#### 確認ダイアログ
- **MUST** 確認ダイアログは重大かつ不可逆な操作にのみ使う（削除、大きな購入、アカウント変更）
- **MUST** 確認ダイアログは具体的な結果を記述する（「検査記録3件を削除しますか？この操作は取り消せません」）
- **MUST** 確認ダイアログのボタンは結果を要約するラベルにする（「レコードを削除」/「キャンセル」）。「はい」/「いいえ」は不可
- **NEVER** 日常操作に確認ダイアログを使わない。乱用すると「確認疲れ」で自動的に「はい」をクリックするようになる

#### Undo vs Confirm
- **SHOULD** 復元可能なアクションには確認よりも Undo を優先する
- **MUST** Undo 不可能なアクション（永久削除、メール送信、金融取引）には確認ダイアログを使う
- **SHOULD** 可能な限りソフトデリート（ゴミ箱/アーカイブ）を実装する

#### フォームバリデーション
- **SHOULD** フィールド離脱時（onBlur）にインラインバリデーションする。入力中（onChange）にエラーを出さない
- **MUST** 入力制約（フォーマット要件、文字数制限）は入力前に事前表示する。エラー後に初めて明かさない
- **SHOULD** 「正しい入力は即座に褒め、誤りは遅らせる」パターンを採用する
- **NEVER** ユーザーがフィールドに触れる前にバリデーションエラーを表示しない

### フロー継続性（Flow Continuity）

#### モーダル vs 新規ページ vs インライン編集

| パターン | 適切な場面 | 不適切な場面 |
|----------|-----------|-------------|
| **インライン編集** | 単一フィールドの簡単な編集、コンテキスト維持が重要 | 複雑な入力、複数関連フィールド |
| **モーダル** | 1ステップの集中サブタスク、不可逆操作の確認 | マルチステップフロー、多数フィールドのフォーム |
| **新規ページ** | マルチステップフロー、複雑なフォーム、時間のかかるタスク | 単純な確認、クイック編集 |

- **SHOULD** 最も破壊性の低いパターンをデフォルトにする: インライン → 新規ページ → モーダルの順に検討する
- **MUST** ワークフロー間でユーザーが記憶に頼る必要がないようにする。現在の画面で過去の決定と今後の期待を示す
- **MUST** 長いフォームにはオートセーブ/下書き保存を実装し、中断後に再開できるようにする
- **NEVER** マルチステップフローにモーダルを使わない。複数ステップが必要なら専用ページにする

### 状態遷移（State Transitions）

- **MUST** データ駆動のすべてのビューに3つの状態を設計する: 空の状態、アクティブ状態、完了/クリア状態
- **MUST** 空の状態には: (1) 通常何が表示されるかの説明、(2) 次に何をすべきかのガイド、(3) 開始するための明確なCTA を含める
- **MUST** 「結果なし」の空の状態には代替案を提示する（より広い検索、異なるフィルター、カテゴリ閲覧）
- **MUST** エラー状態には何が起きたかの説明と回復手段を含める
- **SHOULD** 初回利用の空の状態にはサンプルデータやスターターコンテンツを提供する
- **NEVER** データがないときに説明なしの真っ白な画面を表示しない
- **NEVER** 異なるコンテキストで同じ汎用的な空の状態メッセージを使い回さない

### 認知負荷（Cognitive Load）

- **MUST** Hick の法則: 選択肢数を制限して意思決定時間を短縮する
- **MUST** Miller の法則: 情報を5〜7個の関連アイテムにチャンク化する
- **MUST** マルチステッププロセスにはプログレスインジケーターを表示する（Zeigarnik 効果の活用）
- **SHOULD** 7個以上のグループ化されていない選択肢を単一メニューに表示する場合は検索やカテゴリ分けを提供する
- **SHOULD** セットアップ/オンボーディングフローでは完了率を表示して完了動機を高める
- **NEVER** マルチステップフローの開始後にプログレスインジケーターを消さない

---

## よくある違反パターン

### 登録前に後続アクションを表示
```tsx
// NG: まだ発注が登録されていないのに「発注書出力」がある
<Header title="発注登録">
  <button>発注書出力</button>  {/* 登録前に出力は不可能 */}
</Header>
<form>...</form>
<button>発注登録</button>

// OK: 登録完了後の画面に「発注書出力」を配置
// 登録ページ
<Header title="発注登録" />
<form>...</form>
<button>発注登録</button>

// 完了後 → 一覧に戻り、登録済みレコードの操作列に「発注書出力」
// または完了画面に次ステップとして配置
<div>
  <p>発注 #PO-20250203-0001 を登録しました</p>
  <button>発注書を出力する</button>
  <button>一覧に戻る</button>
</div>
```

### デッドエンドの完了画面
```tsx
// NG: チェックマークだけで次のアクションがない
<div>
  <span>✓</span>
  <p>登録が完了しました</p>
</div>

// OK: 次ステップを提示
<div>
  <p>発注 #PO-20250203-0001 を登録しました（3品目 / ¥46,860,000）</p>
  <div>
    <button>発注書を出力する</button>
    <button>発注一覧に戻る</button>
    <button>新しい発注を登録する</button>
  </div>
</div>
```

### 確認ダイアログの汎用ラベル
```tsx
// NG: 「はい」「いいえ」
<ConfirmDialog
  title="確認"
  message="本当によろしいですか？"
  confirmLabel="はい"
  cancelLabel="いいえ"
/>

// OK: 結果を要約するラベル
<ConfirmDialog
  title="発注登録確認"
  message="発注を登録します。品目数: 3件 / 合計金額: ¥46,860,000"
  confirmLabel="発注を登録する"
  cancelLabel="キャンセル"
/>
```

### Disabled ボタンの説明不足
```tsx
// NG: なぜ無効か分からない
<button disabled style={{ opacity: 0.5 }}>発注登録</button>

// OK: 理由を説明する
<div>
  <button disabled style={{ opacity: 0.5 }}>発注登録</button>
  <p style={{ fontSize: '12px', color: '#6b7280' }}>
    納期を設定すると登録できます
  </p>
</div>
```

### 日常操作への過剰な確認
```tsx
// NG: お気に入り追加に確認ダイアログ
const handleFavorite = () => {
  showConfirmDialog({
    message: 'お気に入りに追加しますか？',
    onConfirm: () => addFavorite(id),
  });
};

// OK: 即座に実行 + Undo トースト
const handleFavorite = () => {
  addFavorite(id);
  showToast({
    message: 'お気に入りに追加しました',
    action: { label: '取り消す', onClick: () => removeFavorite(id) },
  });
};
```

### 空の状態の手抜き
```tsx
// NG: 汎用メッセージ
<div>データがありません</div>

// OK: コンテキストに合わせた説明 + CTA
<div>
  <p>発注明細がまだありません</p>
  <p>見積登録を完了すると、明細が自動的に表示されます。</p>
  <button>見積一覧に戻る</button>
</div>
```

---

## 判断フローチャート

### アクション配置の判断
```
ユーザーの現在のタスクは何か？
  → 登録/作成中
    → 必要なアクション: 入力補助、保存、キャンセルのみ
    → 出力/共有/印刷 は完了後に配置
  → 閲覧中
    → 必要なアクション: 編集、削除、出力、共有
  → 編集中
    → 必要なアクション: 保存、キャンセル
```

### 確認パターンの判断
```
操作は元に戻せるか？
  → 戻せる → Undo パターン（即実行 + 取り消しトースト）
  → 戻せない
    → 重大な影響があるか？
      → ある → 確認ダイアログ（具体的な結果を記述）
      → ない → そのまま実行
```

---

## 関連リソース

- [NNGroup: Progressive Disclosure](https://www.nngroup.com/articles/progressive-disclosure/) - 段階的開示の原則
- [NNGroup: Confirmation Dialogs](https://www.nngroup.com/articles/confirmation-dialog/) - 確認パターン
- [NNGroup: Modal & Nonmodal Dialogs](https://www.nngroup.com/articles/modal-nonmodal-dialog/) - モーダル使い分け
- [NNGroup: Workflow Expectations](https://www.nngroup.com/articles/workflow-expectations/) - フロー設計
- [NNGroup: Wizards](https://www.nngroup.com/articles/wizards/) - ウィザードパターン
- [NNGroup: Empty State Design](https://www.nngroup.com/articles/empty-state-interface-design/) - 空の状態設計
- [Luke Wroblewski: Primary & Secondary Actions](https://www.lukew.com/ff/entry.asp?571=) - ボタン階層
- [Baymard Institute: Form Design](https://baymard.com/learn/form-design) - フォーム設計
- [Laws of UX](https://lawsofux.com/) - UXの法則集
- [Steve Krug: Don't Make Me Think](https://en.wikipedia.org/wiki/Don%27t_Make_Me_Think) - 自明なUI
