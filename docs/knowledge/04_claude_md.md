# 第4章：CLAUDE.mdによるプロジェクトルール定義

## 4.1 CLAUDE.mdとは

### 概要

CLAUDE.mdは、プロジェクトのルートディレクトリに配置する設定ファイルです。Claude Codeはセッション開始時にこのファイルを自動で読み込み、記載されたルールに従って作業を行います。

### 役割と効果

| 役割 | 効果 |
|------|------|
| **プロジェクト概要の共有** | 毎回の説明が不要になる |
| **コーディング規約の統一** | 一貫性のあるコード生成 |
| **禁止事項の明示** | 望ましくない実装を防止 |
| **品質基準の設定** | 一定水準以上の出力を維持 |

### 配置場所

```
project-root/
├── CLAUDE.md          ← ここに配置
├── package.json
└── ...
```

> **ポイント**: CLAUDE.mdはプロジェクトルートに1つ配置します。サブディレクトリには配置しません。

---

## 4.2 CLAUDE.mdをプロンプトで作成する

### Step 1: 初期CLAUDE.mdの生成

プロジェクト初期化後、以下のプロンプトでCLAUDE.mdを自動生成します。

```
このプロジェクト用のCLAUDE.mdを作成して。

【プロジェクト概要】
- プロジェクト名: [プロジェクト名]
- 概要: [システムの目的を1-2文で]
- 対象ユーザー: [誰が使うか]

【技術スタック】
- Next.js 14+ (App Router)
- TypeScript
- Tailwind CSS
- Zustand

【含めてほしいルール】
- UI/UXルール
- レイアウトルール
- デザイン品質ルール
- 禁止事項
```

**実行例**:
```
このプロジェクト用のCLAUDE.mdを作成して。

【プロジェクト概要】
- プロジェクト名: 医療機器管理システム
- 概要: 病院内の医療機器を管理するシステムの画面モック
- 対象ユーザー: 病院の資産管理担当者

【技術スタック】
- Next.js 14+ (App Router)
- TypeScript
- Tailwind CSS
- Zustand

【含めてほしいルール】
- UI/UXルール
- レイアウトルール
- デザイン品質ルール
- 禁止事項
```

---

### Step 2: 業界・ドメイン特有のルールを追加

初期生成後、プロジェクトの特性に合わせたルールを追加します。

```
CLAUDE.mdに以下のルールを追加して。

【業務システム特有のルール】
- 入力幅は期待データ長に合わせる（郵便番号: 100px、電話: 150px、メール: 280px）
- 金額・数量は右寄せ + tabular-nums
- 必須項目には「*」または「必須」ラベル
- 削除操作には確認ダイアログ（対象を明記）
```

---

### Step 3: 問題が発生したらルールを追加

開発中に品質問題が繰り返し発生したら、その都度ルールを追加します。

**例1: h-screenの問題が発生した場合**
```
CLAUDE.mdに以下の禁止事項を追加して。

【追加する禁止事項】
- `h-screen` は使用禁止。代わりに `h-dvh` を使用する
- 理由: モバイルブラウザでアドレスバーの高さが考慮されないため
```

**例2: z-indexが乱立した場合**
```
CLAUDE.mdに以下のルールを追加して。

【追加するルール】
- z-index は固定スケールを使用（任意の値を禁止）
- スケール: 10（ドロップダウン）、20（モーダル背景）、30（モーダル）、40（トースト）、50（ツールチップ）
```

**例3: ボタンラベルが曖昧だった場合**
```
CLAUDE.mdのUXルールに以下を追加して。

【追加するルール】
- ボタンラベルは具体的な動詞にする
- 禁止: 「OK」「はい」「いいえ」
- 推奨: 「保存する」「削除する」「キャンセル」
```

---

## 4.3 CLAUDE.mdの段階的な育て方

### 推奨フロー

```
1. 初期生成（基本ルール）
     ↓
2. 画面モック作成開始
     ↓
3. 問題発生 → ルール追加
     ↓
4. レビューで指摘 → ルール追加
     ↓
5. 成熟したCLAUDE.md完成
```

### 段階別プロンプト例

#### 初期段階（プロジェクト開始時）

```
このプロジェクト用のCLAUDE.mdを作成して。
最低限のUI/UXルールとレイアウトルールを含めて。
業務システム向けのベストプラクティスを反映して。
```

#### 成長段階（開発中）

```
現在のCLAUDE.mdを確認して。
以下の問題が発生したので、防止するルールを追加して。

【発生した問題】
- [問題の内容]

【期待する動作】
- [どうあるべきか]
```

#### 成熟段階（プロジェクト後半）

```
現在のCLAUDE.mdをレビューして。
矛盾するルールや不足しているルールがあれば指摘して。
```

---

## 4.4 よく使うルール追加プロンプト

### UIルール追加

```
CLAUDE.mdのUIルールに以下を追加して。

- アイコンのみボタンには `aria-label` 必須
- 破壊的アクションには `AlertDialog` を使用
- タッチターゲットは最低 44x44px
- フォーム送信後は成功/失敗フィードバックを即座に表示
```

### レイアウトルール追加

```
CLAUDE.mdのレイアウトルールに以下を追加して。

【入力幅】
- 郵便番号: 100px
- 電話番号: 150px
- メールアドレス: 280px
- 日付: 150-180px
- 数値: 60-80px

【スペーシング】
- 8pxの倍数を基本とする
- セクション間: 32-48px
- グループ間: 16-24px
- 項目間: 8-16px
```

### デザイン品質ルール追加

```
CLAUDE.mdのデザインルールに以下を追加して。

【色】
- 通常テキストのコントラスト比 4.5:1 以上（WCAG AA）
- 純粋な黒 #000000 禁止 → ニアブラック（#111827等）を使用

【タイポグラフィ】
- データ値には `tabular-nums`
- 見出しに `text-balance`
- フォントウェイトは最大3種（400, 500-600, 700）
```

### 禁止事項追加

```
CLAUDE.mdの禁止事項に以下を追加して。

- `h-screen` 禁止（`h-dvh` を使用）
- 任意の z-index 値禁止（固定スケールを使用）
- グラデーション禁止（明示的な要求がない限り）
- アニメーション禁止（明示的な要求がない限り）
- ペーストブロック禁止（input/textareaで）
```

---

## 4.5 CLAUDE.mdの確認・修正プロンプト

### 現在の内容を確認

```
現在のCLAUDE.mdの内容を要約して。
主要なルールをカテゴリ別に一覧で表示して。
```

### 特定のルールを修正

```
CLAUDE.mdの以下の部分を修正して。

【修正箇所】
- 現在: [現在の記載]
- 変更後: [変更したい内容]
```

### ルールの整理・統合

```
CLAUDE.mdを整理して。

【やってほしいこと】
- 重複するルールを統合
- 矛盾するルールを解消
- カテゴリ分けを見直し
- 読みやすく整形
```

---

## 4.6 完成したCLAUDE.mdの例

以下は、本プロジェクトで実際に使用しているCLAUDE.mdの構成です。

```markdown
# 医療機器管理システム - 画面モック

Next.js App Router + Zustand で構築する業務システムの画面モックプロジェクト。

## モック実装ルール

画面を実装・修正する際は、以下の制約を常に守ること。

---

## 1. UI

### コンポーネント・インタラクション
- アイコンのみボタンには `aria-label` 必須
- 破壊的アクションには `AlertDialog` を使用
- `h-screen` 禁止 → `h-dvh` を使用

### タイポグラフィ
- データ値には `tabular-nums`
- 見出しに `text-balance`、本文に `text-pretty`

### UX
- タッチターゲットは最低 44x44px
- 必須項目には `*` または「必須」ラベル
- 削除操作には確認ダイアログ（対象を明記）
- 1画面の主要CTA は3つ以下

---

## 2. レイアウト

### 入力幅
- 郵便番号: 100px / 電話: 150px / メール: 280px / 日付: 150-180px

### スペーシング
- 8px の倍数を使用
- セクション間: 32-48px / グループ間: 16-24px / 項目間: 8-16px

---

## 3. デザイン品質

### 色
- コントラスト比 4.5:1 以上（WCAG AA）
- 純粋な黒 `#000000` 禁止

### タイポグラフィ
- フォントサイズは定義済みスケールから選択
- ウェイトは最大3種（400, 500-600, 700）

---

## 4. UXフロー

- Primary CTA は1画面に1つ
- ボタンラベルは具体的な動詞（「OK」「はい」禁止）
- 完了画面は「次に何をすべきか」を必ず示す
```

---

## 4.7 CLAUDE.md運用のベストプラクティス

### Do（推奨）

| 項目 | 理由 |
|------|------|
| 問題発生時にルール追加 | 再発防止になる |
| 具体的な数値を記載 | 曖昧さを排除 |
| 禁止事項を明示 | 望ましくない実装を防止 |
| 定期的に整理 | 可読性を維持 |

### Don't（非推奨）

| 項目 | 理由 |
|------|------|
| 最初から完璧を目指す | 過剰なルールは邪魔になる |
| 長すぎる説明 | 読み込みに時間がかかる |
| 矛盾するルール | 混乱を招く |
| 変更履歴を残さない | 意図が不明になる |

### 更新タイミング

1. **プロジェクト開始時** - 初期ルールを生成
2. **問題が発生したとき** - 防止ルールを追加
3. **レビューで指摘があったとき** - ルールを強化
4. **定期的（週1回程度）** - 整理・統合
