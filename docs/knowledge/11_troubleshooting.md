# 第11章：トラブルシューティング

## 11.1 よくあるエラーと対処法

### インストール・起動系

| エラー | 原因 | 対処法 |
|--------|------|--------|
| `command not found: claude` | パスが通っていない | `npm config get prefix`で確認し、PATHに追加 |
| `EACCES: permission denied` | 権限不足 | `sudo npm install -g @anthropic-ai/claude-code` |
| `認証エラー` | 未認証またはトークン期限切れ | `claude`を再実行して認証フロー実施 |
| `プランをアップグレードしてください` | Max Plan未加入 | Max Planに加入 |

### 解決手順：command not found

```bash
# Step 1: npmのグローバルパスを確認
npm config get prefix
# 出力例: /usr/local

# Step 2: パスを確認
echo $PATH

# Step 3: パスが含まれていない場合、追加
# ~/.bashrc または ~/.zshrc に追加
export PATH="$PATH:/usr/local/bin"

# Step 4: 設定を反映
source ~/.bashrc  # または source ~/.zshrc

# Step 5: 確認
claude --version
```

---

### ビルド・実行系

| エラー | 原因 | 対処法 |
|--------|------|--------|
| `Module not found` | パッケージ未インストール | `npm install`を実行 |
| `Type error` | TypeScript型エラー | エラーメッセージに従い修正 |
| `ENOENT: no such file or directory` | ファイルパスが間違っている | パスを確認・修正 |
| `Port 3000 is already in use` | ポート競合 | 別のターミナルのプロセスを終了 |

### 解決手順：Module not found

```bash
# Step 1: node_modulesを削除
rm -rf node_modules

# Step 2: package-lock.jsonを削除（任意）
rm package-lock.json

# Step 3: 再インストール
npm install

# Step 4: 再実行
npm run dev
```

---

### Git/GitHub系

| エラー | 原因 | 対処法 |
|--------|------|--------|
| `fatal: not a git repository` | Git未初期化 | `git init`を実行 |
| `Permission denied (publickey)` | SSH鍵未設定 | SSH鍵を生成してGitHubに登録 |
| `Updates were rejected` | リモートに新しいコミットあり | `git pull`してからpush |
| `gh: command not found` | GitHub CLI未インストール | `brew install gh`（Mac）でインストール |

---

## 11.2 生成品質が低い場合の対処

### 原因と対処法

| 症状 | 考えられる原因 | 対処法 |
|------|--------------|--------|
| 意図と違う実装 | 指示が曖昧 | より具体的に指示を出し直す |
| デザインが雑 | ルールが伝わっていない | CLAUDE.mdにルールを追加 |
| 同じミスを繰り返す | 学習されていない | Skillを作成してルール化 |
| 古い書き方をする | 最新情報を知らない | 使いたい書き方を明示 |

---

### 品質向上テクニック

**1. 具体的な例を示す**

悪い例：
```
ボタンを作って
```

良い例：
```
以下の仕様でボタンを作って。
- ラベル: 「保存する」
- 色: 緑（#27ae60）
- サイズ: 幅160px、高さ44px
- ホバー時: 少し暗く
- クリック時: ローディング表示
```

---

**2. 参考を示す**

```
以下の画面を参考に、同じテイストで作って。
[参考画面のスクリーンショットパスまたはURL]

【取り入れたい要素】
- カードのシャドウ
- ヘッダーの配色
- ボタンの角丸

【変更したい点】
- フォントサイズをもう少し大きく
```

---

**3. 段階的に指示する**

一度に多くの指示を出さず、段階的に進める：

```
Step 1: まずレイアウトの骨格だけ作って
Step 2: 次にヘッダー部分を詳細化して
Step 3: 次にフォーム部分を作って
Step 4: 最後にボタンとフッターを追加して
```

---

**4. レビューを依頼する**

```
作成した画面をレビューして。

【レビュー観点】
- CLAUDE.mdのルールに準拠しているか
- レスポンシブ対応できているか
- アクセシビリティは問題ないか

問題があれば修正して。
```

---

## 11.3 コスト超過への対応

### コスト確認方法

```
/cost
```

### コスト削減テクニック

| テクニック | 効果 | 方法 |
|-----------|------|------|
| CLAUDE.md活用 | 毎回の説明が不要に | ルールを文書化 |
| 明確な指示 | 試行錯誤を減らす | 具体的に指示 |
| スコープを絞る | 無駄な処理を防ぐ | 1タスク1指示 |
| /compact使用 | コンテキストを圧縮 | 長時間作業時に実行 |

---

### /compact の使い方

長時間作業していると、コンテキストが肥大化してコストが増加します。

```
/compact
```

を実行すると、会話履歴が要約されてコンテキストサイズが削減されます。

**使用タイミング**：
- 1時間以上連続作業した後
- 大量のファイルを読み込んだ後
- コストが気になってきた時

---

## 11.4 動作が遅い場合の対処

### 原因と対処法

| 症状 | 原因 | 対処法 |
|------|------|--------|
| レスポンスが遅い | ネットワーク | 接続を確認、時間を置いて再試行 |
| ファイル操作が遅い | 大量ファイル | スコープを絞る |
| 処理がタイムアウト | 処理が重すぎる | 処理を分割 |

---

### パフォーマンス改善テクニック

**1. 対象ファイルを限定する**

悪い例：
```
プロジェクト全体をレビューして
```

良い例：
```
app/login/page.tsxをレビューして
```

---

**2. 処理を分割する**

悪い例：
```
全画面のモックを一度に作って
```

良い例：
```
まずログイン画面のモックを作って
（完了後）
次にメイン画面のモックを作って
```

---

**3. 不要なファイルを除外する**

`.gitignore`に以下を追加して、不要なファイルを除外：

```
node_modules/
.next/
out/
*.log
```

---

## 11.5 その他のトラブル

### セッションが切れた場合

セッションが切れても、プロジェクトのファイルは保持されています。

```bash
# 同じディレクトリで再起動
cd /path/to/project
claude
```

再起動後、以下のように続きを伝えます：
```
前回の続きで、[画面名]の修正を続けて。
前回の指摘事項は[内容]だった。
```

---

### 意図しないファイルが変更された場合

Gitで変更を確認し、必要に応じて元に戻します：

```bash
# 変更を確認
git status
git diff

# 特定ファイルを元に戻す
git checkout -- path/to/file

# 全ての変更を元に戻す（注意！）
git checkout -- .
```

---

### Claude Codeがフリーズした場合

```bash
# Ctrl+C で中断
# それでも止まらない場合は、ターミナルを閉じて再起動
```

---

## 11.6 サポート情報

### 公式ドキュメント

- Claude Code公式: https://docs.anthropic.com/claude-code

### 問題報告

- GitHub Issues: https://github.com/anthropics/claude-code/issues

### コミュニティ

- Anthropic Discord（公式）
