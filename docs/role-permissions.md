# ロール別権限定義

## 概要

本システムでは6つのロールを定義し、各ロールに応じた画面・機能へのアクセス制御を行う。

---

## ロール一覧

| ロール | ラベル | 所属 | 説明 |
|--------|--------|------|------|
| `admin` | システム管理者 | SHIP | システム全体の管理権限を持つ |
| `consultant` | SHRCコンサル | SHIP | 担当施設の資産閲覧・個体管理リスト作成・タスク管理が主業務 |
| `sales` | GHS営業 | SHIP | 閲覧のみ（営業活動のための情報確認用） |
| `office_admin` | 事務管理者 | 病院 | 事務担当者の権限 + マスタ管理・ユーザー管理 |
| `office_staff` | 事務担当者 | 病院 | タスク管理画面での業務が中心 |
| `clinical_staff` | 臨床スタッフ | 病院 | 現場での申請作成・点検実施・貸出実施 |

---

## 権限レベル

| 記号 | 意味 |
|------|------|
| `F` | フルアクセス（全操作可能） |
| `W` | 閲覧 + 編集 |
| `R` | 閲覧のみ |
| `C` | 作成 + 自分の申請の閲覧 |
| `✕` | アクセス不可 |

---

## 権限マトリクス

### メイン画面

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| メイン画面表示 | F | W | R | W | W | R |

### 資産関連

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| 資産検索・閲覧 | F | R (担当施設) | R | W | R | R |
| 資産詳細表示 | F | R (担当施設) | R | W | W | R |
| 資産編集 | F | ✕ | ✕ | W | W | ✕ |
| 個体管理リスト作成 | F | W | ✕ | ✕ | ✕ | ✕ |

### 現有資産調査

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| オフライン準備 | F | W | ✕ | W | W | W |
| 調査場所選択 | F | W | ✕ | W | W | W |
| 資産調査入力 | F | W | ✕ | W | W | W |
| 調査履歴 | F | W | ✕ | W | W | W |

### 棚卸

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| 棚卸管理 | F | W | ✕ | W | W | R |

### QRコード

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| QR発行 | F | W | ✕ | W | W | ✕ |
| QR印刷 | F | W | ✕ | W | W | ✕ |

### 購入管理

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| 見積書管理 | F | ✕ | R | W | W | ✕ |
| 見積処理 | F | ✕ | R | W | W | ✕ |

### 修理

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| 修理依頼（申請作成） | F | ✕ | ✕ | W | W | C |
| 修理タスク管理 | F | W | R | W | W | ✕ |

### 貸出

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| 貸出可能機器一覧 | F | ✕ | R | W | W | R |
| 貸出実施 | F | ✕ | ✕ | W | W | W |
| 貸出タスク管理 | F | W | R | W | W | ✕ |

### 点検

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| 日常点検実施 | F | ✕ | ✕ | W | W | W |
| 点検準備 | F | W | ✕ | W | W | ✕ |
| 点検結果 | F | W | ✕ | W | W | R |

### 保守

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| 保守見積登録 | F | ✕ | R | W | W | ✕ |
| メーカー保守結果 | F | W | R | W | W | ✕ |

### 廃棄

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| 廃棄タスク | F | W | ✕ | W | W | ✕ |

### マスタ管理

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| 資産マスタ（SHIP） | F | R | ✕ | ✕ | ✕ | ✕ |
| 施設マスタ（SHIP） | F | R | ✕ | ✕ | ✕ | ✕ |
| 部門マスタ（SHIP） | F | R | ✕ | ✕ | ✕ | ✕ |
| 個別施設マスタ | F | R | ✕ | W | R | ✕ |

### ユーザー管理

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| ユーザー管理 | F | ✕ | ✕ | W (所属施設のみ) | ✕ | ✕ |

### データ管理

| 機能 | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| 資産インポート | F | W | ✕ | W | ✕ | ✕ |
| データマッチング | F | W | ✕ | W | ✕ | ✕ |

---

## ロール別サマリー

### admin（システム管理者）

**できること:**
- 全機能へのフルアクセス

**できないこと:**
- なし

---

### consultant（SHRCコンサル）

**できること:**
- 担当施設の資産閲覧
- 個体管理リスト作成
- タスク管理画面（購入管理・購入見積依頼以外すべて）
  - 修理タスク管理
  - 貸出タスク管理
  - 点検準備・点検結果
  - メーカー保守結果
  - 廃棄タスク
- 現有資産調査フロー
- 棚卸管理
- QRコード発行・印刷
- 資産インポート・データマッチング
- SHIPマスタの閲覧

**できないこと:**
- 担当施設の資産編集
- メイン画面の「保守点検」「貸出管理」「修理申請」
- 購入管理（見積書管理・見積処理）
- ユーザー管理
- 個別施設マスタの編集

**制約:**
- `user.accessibleFacilities` に含まれる施設のみアクセス可能

---

### sales（GHS営業）

**できること:**
- 資産の閲覧
- 修理タスク・貸出タスクの閲覧
- 見積書管理・保守見積の閲覧

**できないこと:**
- 編集・作成系すべて
- タスク管理画面での操作
- マスタ管理
- ユーザー管理
- QRコード発行
- 現有資産調査
- 棚卸

---

### office_admin（事務管理者）

**できること:**
- 事務担当者の全権限
- 個別施設マスタのCRUD（作成・編集・削除）
- ユーザー管理（所属施設のユーザーのみ）

**できないこと:**
- 個体管理リスト作成
- SHIPマスタの編集
- 資産インポート・データマッチング

---

### office_staff（事務担当者）

**できること:**
- タスク管理画面での業務
  - 購入管理（見積書管理・見積処理）
  - 修理タスク管理
  - 貸出タスク管理
  - 点検準備・点検結果
  - 保守見積登録・メーカー保守結果
  - 廃棄タスク
- 資産詳細の編集
- 現有資産調査フロー
- 棚卸管理
- QRコード発行・印刷
- 個別施設マスタの閲覧

**できないこと:**
- 個体管理リスト作成
- マスタ管理（編集）
- ユーザー管理
- 資産インポート・データマッチング

---

### clinical_staff（臨床スタッフ）

**できること:**
- 各種申請の作成 + 自分の申請の閲覧
  - 修理依頼
- 点検実施（日常点検）
- 貸出実施
- 現有資産調査フロー
- 資産の閲覧
- 棚卸の閲覧
- 点検結果の閲覧
- 貸出可能機器の閲覧

**できないこと:**
- タスク管理画面へのアクセス
- 個体管理リスト作成
- 資産編集
- QRコード発行
- マスタ管理
- ユーザー管理
- 購入管理
- 保守管理
- 廃棄タスク

---

## 補足事項

### 担当施設の制御

- `consultant` ロールは `user.accessibleFacilities` 配列に含まれる施設のみアクセス可能
- `office_admin` のユーザー管理は `user.hospital` に所属するユーザーのみ対象

### メイン画面の表示制御

メイン画面のメニューボタンは、ユーザーのロールに応じて表示/非表示を切り替える。

| ボタン | admin | consultant | sales | office_admin | office_staff | clinical_staff |
|--------|:-----:|:----------:|:-----:|:------------:|:------------:|:--------------:|
| 資産リスト | ○ | ○ | ○ | ○ | ○ | ○ |
| 編集リスト | ○ | ○ | ✕ | ✕ | ✕ | ✕ |
| 購入管理 | ○ | ✕ | ○ | ○ | ○ | ✕ |
| 保守点検 | ○ | ✕ | ✕ | ○ | ○ | ○ |
| 貸出管理 | ○ | ✕ | ○ | ○ | ○ | ○ |
| 修理申請 | ○ | ✕ | ✕ | ○ | ○ | ○ |
| 現有資産調査 | ○ | ○ | ✕ | ○ | ○ | ○ |
| マスタ管理 | ○ | ○ | ✕ | ○ | ○ | ✕ |
| ユーザー管理 | ○ | ✕ | ✕ | ○ | ✕ | ✕ |

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-02-18 | 初版作成 |
